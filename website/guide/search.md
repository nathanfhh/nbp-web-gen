# 智慧搜尋

當歷史紀錄越來越多，智慧搜尋讓你快速找到過去的生成結果。結合關鍵字比對和語意理解，即使你不記得確切的提示詞，也能透過描述找到相關紀錄。

## 開啟搜尋

在歷史紀錄區域上方，點擊搜尋按鈕（🔍）開啟搜尋面板。

![搜尋面板](/images/search-modal.webp)

## 基本用法

1. 在搜尋框輸入關鍵字或描述
2. 搜尋結果會即時顯示
3. 點擊結果可在燈箱中預覽

### 搜尋結果

每筆搜尋結果包含：

| 項目 | 說明 |
|------|------|
| 縮圖 | 生成結果的預覽圖 |
| 模式標籤 | 生成模式（生成、貼圖、影片等） |
| 時間 | 生成的時間 |
| 摘要片段 | 匹配的提示詞片段，關鍵字會以螢光標記 |

## 搜尋策略

提供三種搜尋策略，適用於不同場景：

| 策略 | 說明 | 適用場景 |
|------|------|----------|
| 混合搜尋 | 結合關鍵字和語意搜尋（預設） | 大部分情況 |
| 語意搜尋 | 純語意理解，不需精確匹配 | 「找那張有夕陽的圖」 |
| 關鍵字搜尋 | 純 BM25 關鍵字比對 | 搜尋特定詞彙或名稱 |

::: tip 提示
混合搜尋是預設策略，在大多數情況下效果最好。如果你的描述比較模糊，可以嘗試切換到語意搜尋。
:::

## Embedding 引擎

搜尋系統支援兩種 embedding 引擎，用於語意搜尋的向量生成：

| 引擎 | 模型 | 維度 | 說明 |
|------|------|------|------|
| ☁️ Gemini | Gemini Embedding API | 768 維 | 雲端 API，品質較高，需消耗 API 額度 |
| 📱 Local | multilingual-e5-small | 384 維 | 瀏覽器本地端推論，免費但需下載模型（~33MB） |

### 首次使用

首次開啟搜尋面板時，系統會要求你選擇 embedding 引擎：

1. **Gemini** — 使用 Gemini Embedding API 進行語意編碼，品質較高，會消耗少量 API 額度（$0.15 / 百萬 tokens）
2. **Local** — 在瀏覽器中下載並執行 Transformers.js 模型，完全免費，首次需下載約 33MB 模型檔

選擇後可隨時在搜尋面板中切換引擎。切換引擎後，系統會自動為已索引的紀錄補齊新引擎的 embedding 向量。

::: info 說明
兩種引擎的索引資料是獨立儲存的。切換引擎不會刪除原有索引，隨時可以切回。
:::

::: warning 隱私提醒
使用 Gemini 引擎時，你的提示詞文字會發送到 Google API 進行 embedding 編碼。如果你使用 Free Tier API Key，Google 可能會將輸入資料用於模型訓練。若有隱私考量，建議使用 Local 引擎或付費 API Key。
:::

## 模式篩選

你可以按照生成模式篩選搜尋結果：

- 全部
- 生成
- 貼圖
- 編輯
- 故事
- 圖表
- 影片
- 簡報
- Agent

## 排序方式

搜尋結果支援三種排序：

| 排序 | 說明 |
|------|------|
| 相關度 | 依匹配程度排序（預設） |
| 最新優先 | 依生成時間降序 |
| 最舊優先 | 依生成時間升序 |

## 即時同步

搜尋索引會自動與歷史紀錄保持同步：

- **新增紀錄** — 生成完成後自動加入索引
- **刪除紀錄** — 刪除紀錄時同步移除索引
- **匯入紀錄** — 匯入歷史紀錄後自動補充索引
- **清除全部** — 清空歷史時同步清除索引

你不需要手動管理索引，系統會在背景自動完成。

## Embedding 3D 探索器

搜尋面板右上角的散佈圖按鈕可以開啟 **Embedding 3D 探索器**，將所有已索引紀錄的 embedding 向量以互動式 3D 散佈圖視覺化。

### 功能

- **資料來源選擇** — 可分別檢視 Local 或 Gemini 引擎的 embedding 資料
- **抽樣控制** — 設定抽樣數量或使用全部資料
- **著色模式** — 依生成模式著色（每個模式有不同顏色）或單一顏色
- **Hover 文字** — 設定滑鼠懸停時顯示的資訊（僅 ID、截斷文字、完整文字）
- **3D 互動** — 可旋轉、縮放、平移探索向量空間的分佈

![Embedding 3D 探索器](/images/embedding-tool.webp)

### 使用方式

1. 開啟搜尋面板
2. 點擊右上角散佈圖圖示
3. 選擇資料來源（Local / Gemini）
4. 點擊「開始處理」
5. 系統會執行 UMAP 降維，將高維向量（384/768 維）降到 3D

::: tip 提示
距離相近的點代表語意相似的紀錄。透過按模式著色，可以觀察不同生成模式的紀錄是否在向量空間中形成群集。
:::

## 偏好記憶

你的搜尋偏好會自動儲存，包含：

- 上次選擇的模式篩選
- 上次使用的搜尋策略
- 上次使用的排序方式

下次開啟搜尋面板時，會自動套用上次的設定。

## 多語言支援

搜尋引擎針對中日韓文（CJK）做了特別優化，能正確處理中文、日文、韓文的分詞，確保搜尋結果準確。同時也完整支援英文和其他語言的搜尋。

## 下一步

- [歷史紀錄](./history) - 管理所有生成紀錄
- [角色庫](./character-library) - 從歷史紀錄建立角色
