# 更新日誌

此頁面記錄 Mediator 的版本更新內容。

## v0.31.0

_2026-02-28_

### 新功能
- **簡報頁面編輯**: 在頁面卡片中新增內聯編輯功能，可直接修改單頁內容，無需回到上方的完整簡報文字區域。修改後會自動同步回簡報文字區域（雙向綁定）
- **異動偵測**: 每頁自動追蹤內容、風格、旁白三個面向的異動狀態，與生成時的快照比較（非布林標記），修改後復原不會誤判為異動
- **選擇性重新生成**: 新增「僅生成異動頁面」按鈕，顯示詳細的異動分類（如「簡報第 2, 5 頁、錄音第 3 頁」），無需全部重新生成
- **頁面圖片燈箱**: 在頁面卡片中點擊縮圖可開啟燈箱查看大圖，支援旁白音頻播放和逐字稿面板
- **歷史紀錄還原強化**: 從歷史紀錄載入簡報時，完整還原 OPFS 中的圖片和旁白音頻，支援後續的選擇性重新生成

### 修復
- **模型選擇**: 修正同時重新生成圖片與旁白時未使用使用者選擇的圖片模型，導致誤用預設模型的問題
- **歷史還原**: 修正旁白逐字稿的頁面 ID 在還原後與實際頁面不匹配的問題
- **歷史還原**: 修正 localStorage 還原時殘留的無效異動標記

## v0.30.1

_2026-02-27_

### 修復
- **PDF 轉換**: 修正 Worker 初始化失敗後 Promise 永遠不會 reject 的問題，現在會正確重設狀態以允許重試
- **儲存**: 修正圖片/影片/旁白儲存的競態條件，改為依序 await 防止 IndexedDB 併發寫入衝突
- **影片生成**: 修正取消按鈕未實際傳遞 AbortSignal 至輪詢迴圈的問題，現在可正確中斷影片生成
- **影片生成**: 修正 AbortController 在生成失敗時未清理的問題，改用 try/finally 確保所有路徑都重設
- **影片生成**: 修正輪詢等待中 abort listener 未正確清理的問題，防止 listener 累積
- **角色儲存**: 修正動態副檔名寫入後讀取路徑仍硬編碼 `.webp` 的問題，新增多副檔名搜尋機制
- **角色儲存**: 新增 MIME 類型嚴格驗證，拒絕不支援的圖片格式
- **角色儲存**: 儲存新格式時自動刪除舊格式檔案，防止 resolver 返回過期資料
- **圖片預覽**: 修正 Blob URL 記憶體洩漏，改用 watch + revokeObjectURL 清理
- **Inpainting Worker**: 修正 `Array.fill()` 共享參考問題，改用 `Array.from()` 建立獨立物件
- **OCR**: 修正 WebP/GIF 圖片 MIME 類型偵測遺漏，與 Worker 模式對齊
- **OCR**: 修正 `isDetecting` ref 從未被設為 true 的問題
- **主題**: 修正多個元件使用非響應式 DOM 屬性讀取主題的問題，改用 `useTheme()` composable
- **動畫**: 修正 HeroTitle 與 CharacterCarousel 中 setTimeout 未在元件卸載時清理的問題
- **AgentMessage**: 修正 DOMPurify hook 在 HMR 重新載入時重複註冊的問題，新增初始化防護
- **搜尋選擇器**: 將硬編碼英文替換為 i18n 翻譯鍵
- **歷史記錄**: 修正 `truncatePrompt` 在 null 輸入時的 TypeError
- **Embedding 探索器**: 新增 colorBy/hoverText/hoverLength 設定的 watcher 以即時更新圖表
- **P2P 同步**: 修正 `pendingConversation` 在重設狀態時未清除的問題
- **LINE 貼圖**: 修正錯誤路徑中 Object URL 未釋放的記憶體洩漏
- **LINE 貼圖**: 修正對 data URL 錯誤呼叫 `revokeObjectURL` 的問題
- **API Key 管理**: 修正重設計時器在 scope dispose 時未清理的問題

### 重構
- 移除 19 處已確認的死碼（未使用的匯出、不可達的分支、無效 CSS 類別）
- 提取二進位工具函式至共用模組 `binaryUtils.js`（DRY）
- 修正檔案名稱拼寫錯誤 `useCloudfareTurn` → `useCloudflareTurn`
- 移除 `style.css` 中未定義變數的 glow CSS 類別
- 移除 PPTX 匯出中的生產環境除錯日誌
- 簡化主題切換的 `startViewTransition` 條件判斷

### 測試
- 新增 `binaryUtils.js` 的 20 項單元測試（chunked 字串轉換、MIME 偵測、Array.from 模式）

## v0.30.0

_2026-02-27_

### 新功能
- **圖片模型選擇器**: 在全域設定中新增圖片模型切換，支援 Gemini 3 Pro Image（品質較高）與 Gemini 3.1 Flash Image（速度較快），設定自動記住
- **簡報轉 PPTX**: 新增第三個文字移除模型「Nano Banana 2」（`gemini-3.1-flash-image-preview`），速度快且品質好，需使用付費金鑰
- **文字模型**: 移除已停用的 Gemini 3 Pro 文字模型，保留 Gemini 3 Flash 與 Gemini 3.1 Pro

### 修復
- **燈箱**: 修正簡報旁白逐字稿在非簡報模式的圖片預覽中錯誤顯示的問題

### 依賴更新
- `@google/genai` 1.41.0 → 1.43.0

---

## 較早版本

### v0.29.x - 燈箱逐字稿面板與旁白語速控制

_2026-02-21_

- **v0.29.2** _(02-21)_: 修正雙人旁白在中文句號後分段異常
- **v0.29.1** _(02-21)_: MP4 匯出旁白語速控制（1x–4x），自製 WSOLA 演算法保持音調不變
- **v0.29.0** _(02-21)_: Lightbox 逐字稿浮動面板（拖曳移動、調整大小、T 鍵切換），修正拖曳時誤觸關閉

### v0.28.x - 智慧搜尋增強、Embedding 3D 探索器與模型統一

_2026-02-15 ~ 2026-02-21_

- **v0.28.4** _(02-21)_: Gemini 3.1 Pro 模型選項、Agent 模式模型修正、TEXT_MODELS 常數統一
- **v0.28.3** _(02-16)_: Embedding 探索器模式篩選、GENERATION_MODES 常數統一
- **v0.28.2** _(02-16)_: Embedding 探索器「依記錄」著色模式、Plotly 工具列修正
- **v0.28.1** _(02-15)_: 智慧搜尋 Agent 紀錄索引修正、雙語模式標籤搜尋
- **v0.28.0** _(02-15)_: 雙 Embedding 引擎（Gemini API + Transformers.js）、Embedding 3D 探索器、Free Tier 隱私提醒

### v0.27.0 - RAG 混合搜尋系統

_2026-02-14_

- 歷史紀錄 RAG 混合搜尋（BM25 + 語意向量）、三種搜尋策略、模式篩選、即時索引同步
- search-core 純函式測試（50+ 測試案例）

### v0.26.x - 旁白語音、Agentic Vision、MP4 匯出與測試基礎建設

_2026-01-28 ~ 2026-02-12_

- **v0.26.22** _(02-12)_: 燈箱導航修正（View Transition 動畫衝突、資訊列重疊）
- **v0.26.21** _(02-09)_: Agentic Vision ghost 訊息修正、imageIndex 對齊、匯出匯入縮圖修正
- **v0.26.20** _(02-09)_: AbortController 修正 ghost API 請求消耗配額
- **v0.26.19** _(02-09)_: 防止快速連點重複生成 race condition
- **v0.26.18** _(02-06)_: Vitest 測試框架（319 個測試）、ESLint 環境修正
- **v0.26.17** _(02-06)_: MP4 解析度選擇（1080p/1440p/2160p）、音訊預覽比較、VBR 編碼
- **v0.26.16** _(02-04)_: 設定重設確認視窗、旁白播放器自動隱藏
- **v0.26.15** _(02-04)_: 旁白播放速度控制、自動播放、空白鍵快捷鍵
- **v0.26.14** _(02-03)_: 平行生成圖片與音訊、useApi 拆分重構
- **v0.26.13** _(02-03)_: 語音試聽、WebM/Opus 編碼取代 MP3
- **v0.26.12** _(02-03)_: Agentic Vision 智慧捲動、平台偵測快捷鍵、內容預覽展開
- **v0.26.11** _(02-01)_: PPTX 字體大小合併閾值修正
- **v0.26.10** _(02-01)_: 貼圖裁切結果面板滾動修正
- **v0.26.9** _(01-31)_: MP4 品質選擇、Agentic Vision 串流自動儲存
- **v0.26.8** _(01-30)_: Agentic Vision 清除對話、Android 相機支援
- **v0.26.7** _(01-30)_: 貼圖分割線 Undo/Redo、Agent 對話圖片燈箱
- **v0.26.6** _(01-29)_: 手動裁切模式、透明邊距自動裁剪
- **v0.26.5** _(01-29)_: Agentic Vision 模式（Gemini 3 Flash）
- **v0.26.4** _(01-29)_: Opus 編碼備援、逐字稿模型 ID 修正
- **v0.26.3** _(01-29)_: 單頁重新生成、crossfade 轉場效果
- **v0.26.2** _(01-28)_: 旁白音頻備份傳輸、匯出格式 v3
- **v0.26.1** _(01-28)_: 貼圖邊緣侵蝕、8-connected flood fill
- **v0.26.0** _(01-28)_: TTS 旁白語音生成、SearchableSelect 元件

### v0.25.x - 文件網站、簡報轉換增強與隱私優先

_2026-01-23 ~ 2026-01-28_

- **v0.25.23** _(01-28)_: 貼圖網格裁切獨立工具頁面、文件首頁循環影片
- **v0.25.21** _(01-27)_: 3D 香蕉模型拖拽旋轉物理效果
- **v0.25.20** _(01-26)_: 移除 GA4 追蹤、aspect-ratio 自適應字型修正
- **v0.25.19** _(01-25)_: 新增更新日誌頁面
- **v0.25.18** _(01-25)_: 簡報轉換離開頁面確認提示
- **v0.25.16** _(01-25)_: 區域編輯器鍵盤快捷鍵
- **v0.25.15** _(01-25)_: 梯形模式支援傾斜文字區域
- **v0.25.12** _(01-24)_: 首頁 Hero 區 3D 香蕉模型
- **v0.25.8** _(01-24)_: Gemini 重新處理確認對話框
- **v0.25.7** _(01-24)_: 深度連結、「試試看」按鈕、API Key 影片教學
- **v0.25.6** _(01-24)_: 延遲載入手繪畫布元件
- **v0.25.0** _(01-23)_: VitePress 文件網站、故事模式角色連貫性、sitemap 索引

### v0.24.x - 手繪畫布與簡報轉換增強

_2026-01-20 ~ 2026-01-23_

- **v0.24.11** _(01-23)_: 修正 Web Worker 中 PDF.js 的 mock document、PPTX 圖片比例保持
- **v0.24.10** _(01-22)_: 手繪功能 UX 改善：導航守衛與顏色選擇器重新定位
- **v0.24.9** _(01-22)_: 新增手繪畫布平移工具
- **v0.24.8** _(01-22)_: 修正行動裝置上參考圖片與角色庫的版面重疊
- **v0.24.0** _(01-20)_: 簡報轉換設定行為文件、Gemini 確認彈窗、WYSIWYG 設定、故事模式部分成功處理

### v0.23.x - SEO 與 OCR 模型選擇

_2026-01-19_

- **v0.23.7**: 修正貼圖裁切按鈕 SVG、無障礙標籤、LCP 優化
- **v0.23.6**: 新增靜態 HTML 生成與每頁 SEO meta 標籤
- **v0.23.5**: PWA 修正、canonical URL 防重複內容
- **v0.23.4**: 新增 JSON-LD 結構化資料、SPA 路由修正
- **v0.23.3**: Toast 滑動關閉手勢、區域選取工具、beforeunload 保護
- **v0.23.2**: 燈箱編輯區域按鈕、OCR 模型大小選擇（Server/Mobile）自動降級
- **v0.23.1**: 智慧捲動（使用者向上捲動時停止自動捲動）、Free Tier API Key 分流
- **v0.23.0**: PPTX 動態文字顏色提取

### v0.22.x - 區域編輯器與 OCR 統一架構

_2026-01-18 ~ 2026-01-19_

- **v0.22.3** _(01-19)_: 區域編輯器復原/重做功能
- **v0.22.2** _(01-19)_: 分隔線工具、縮放放大鏡
- **v0.22.1** _(01-18)_: 高度為基準的字體大小計算
- **v0.22.0** _(01-18)_: Canvas 測量字體大小、CPU/GPU OCR 統一架構

### v0.21.x - WebGPU OCR 與區域編輯

_2026-01-17 ~ 2026-01-18_

- **v0.21.5** _(01-18)_: GPU 記憶體不足時自動降級到 CPU
- **v0.21.4** _(01-18)_: 純 XY-Cut 版面分析、修正 BGR 順序
- **v0.21.3** _(01-17)_: WebGPU 偵測改善
- **v0.21.2** _(01-17)_: 清除模型快取功能、行動裝置 WebGPU 支援
- **v0.21.1** _(01-17)_: 可拖曳區域編輯工具列、自動產生 PPTX 檔名
- **v0.21.0** _(01-17)_: 手動 OCR 區域編輯、Tesseract.js 備援、統一 OCR 介面

### v0.20.x - 簡報轉 PPTX 轉換器

_2026-01-16_

- **v0.20.3**: 排除圖片資料於 localStorage 持久化
- **v0.20.2**: 簡報模式中新增 PPTX 轉換器橫幅
- **v0.20.1**: 檔案上傳模式、處理計時器、OCR JSON 覆蓋層
- **v0.20.0**: 簡報轉 PPTX 轉換器、雙 API Key 管理、圖片比較彈窗

### v0.19.x - AI 內容分割器

_2026-01-15_

- **v0.19.0**: AI 內容分割彈窗、每頁風格指引、生成進度條與 ETA

### v0.18.x - 簡報模式

_2026-01-15_

- **v0.18.0**: 簡報模式，支援參考圖片

### v0.17.x - 影片生成與品牌重塑

_2026-01-14 ~ 2026-01-15_

- **v0.17.3** _(01-15)_: 重構影片 metadata
- **v0.17.2** _(01-15)_: 圖片生成遷移至 @google/genai SDK
- **v0.17.1** _(01-15)_: 移除 generateAudio（Gemini API 不支援）
- **v0.17.0** _(01-14)_: 影片生成模式（Veo 3.1 API）、品牌重塑為 Mediator

### v0.16.x - 角色庫儲存遷移

_2026-01-14_

- **v0.16.0**: 角色圖片遷移至 OPFS

### v0.15.x - 使用者導覽

_2026-01-12 ~ 2026-01-13_

- **v0.15.5** _(01-13)_: 防止貼圖裁切時意外資料遺失
- **v0.15.4** _(01-13)_: 修正導覽提示與生成按鈕重疊
- **v0.15.3** _(01-13)_: 歷史紀錄依生成模式篩選
- **v0.15.2** _(01-13)_: 允許不完全符合規範時下載
- **v0.15.1** _(01-12)_: 行動裝置導覽與角色資訊響應式版面
- **v0.15.0** _(01-12)_: 新使用者導覽、主題類型圖示、主題下拉選單自動捲動

### v0.14.x - 季節主題

_2026-01-12_

- **v0.14.0**: 新增季節主題（春、夏、秋、冬）

### v0.13.x - 更多主題

_2026-01-11 ~ 2026-01-12_

- **v0.13.3** _(01-12)_: 統一模式顏色為品牌色
- **v0.13.2** _(01-12)_: 淺色主題深色覆蓋層徽章使用白色文字
- **v0.13.1** _(01-12)_: 新增 Matcha、Gruvbox、Everforest 主題
- **v0.13.0** _(01-11)_: 新增 Espresso、Mocha、Nord 主題

### v0.12.x - 主題系統完善

_2026-01-11_

- **v0.12.1**: 消除主題切換動畫結束時的閃爍
- **v0.12.0**: 新增暖色主題、語意色彩 token

### v0.11.x - 語意色彩 Token

_2026-01-11_

- **v0.11.1**: 貼圖工具淺色模式文字可見性、主題系統增強
- **v0.11.0**: 主題系統模組化重構、語意色彩 token 遷移

### v0.10.x - LINE 貼圖封面與程式碼重構

_2026-01-10 ~ 2026-01-11_

- **v0.10.4** _(01-11)_: 抽取 HistoryTransfer 為模組化元件
- **v0.10.3** _(01-11)_: 抽取 LineStickerToolView 為模組化元件
- **v0.10.2** _(01-11)_: 抽取 ImageLightbox 為模組化 composables
- **v0.10.1** _(01-11)_: 抽取 usePeerSync、StickerCropper 為模組化 composables
- **v0.10.0** _(01-10)_: LINE 貼圖封面圖、偶數尺寸支援

### v0.9.x - 角色萃取與 LINE 貼圖工具

_2026-01-09_

- **v0.9.2**: 切換貼圖時保留編輯模式設定
- **v0.9.1**: WebRTC 同步支援角色資料
- **v0.9.0**: 角色萃取功能、LINE 貼圖規範工具

### v0.8.x - 深色主題重設計

_2026-01-09_

- **v0.8.0**: Slate Blue Pro 深色主題

### v0.7.x - WebRTC 同步與批次下載

_2026-01-07 ~ 2026-01-09_

- **v0.7.13** _(01-09)_: Bundle 大小優化、程式碼分割與延遲載入
- **v0.7.12** _(01-09)_: 貼圖裁切器二次去背增強
- **v0.7.11** _(01-08)_: Toast 淺色模式高對比設計
- **v0.7.10** _(01-08)_: 淺色模式勾選框顏色統一、選擇性匯出/同步
- **v0.7.9** _(01-08)_: TURN 開關、自動斷線、主題修正
- **v0.7.8** _(01-08)_: 修正傳輸統計準確性、per-record ACK、背壓控制
- **v0.7.7** _(01-07)_: TURN 設定遷移至 Cloudflare API
- **v0.7.6** _(01-07)_: P2P 跨裝置同步（含 TURN 支援）
- **v0.7.5** _(01-07)_: 統一燈箱下載選單、主題修正
- **v0.7.4** _(01-07)_: 移除 IndexedDB 設定 store 死碼
- **v0.7.3** _(01-07)_: 歷史紀錄 ZIP/PDF 批次下載、匯出/匯入功能
- **v0.7.2** _(01-07)_: 歷史紀錄時間戳完整日期提示
- **v0.7.1** _(01-07)_: 新增 CLAUDE.md、dayjs 相對時間
- **v0.7.0** _(01-07)_: PDF 批次下載（Web Worker）、貼圖唯一檔名

### v0.6.x - GA4 追蹤與 PWA

_2026-01-05 ~ 2026-01-06_

- **v0.6.7** _(01-06)_: 貼圖裁切器返回手勢支援
- **v0.6.6** _(01-06)_: 版本號更新通知
- **v0.6.5** _(01-06)_: 還原為投影式貼圖分割（YAGNI）
- **v0.6.4** _(01-06)_: PWA 動態主題色、CCL 過濾優化
- **v0.6.3** _(01-06)_: 貼圖分割 Web Worker + CCL 演算法優化
- **v0.6.2** _(01-06)_: PWA 支援
- **v0.6.1** _(01-05)_: Google Analytics 4 追蹤
- **v0.6.0** _(01-05)_: 程式碼大重構與 DRY 改善

### v0.5.x - 貼圖模式與國際化

_2026-01-04 ~ 2026-01-05_

- **v0.5.5** _(01-05)_: SEO meta 標籤、GitHub Pages 部署
- **v0.5.4** _(01-05)_: 抽取 GitHubLink 元件
- **v0.5.3** _(01-04)_: 貼圖處理覆蓋層動畫、BFS flood fill 優化
- **v0.5.2** _(01-04)_: 貼圖裁切器版面與捲動改善
- **v0.5.1** _(01-04)_: 貼圖裁切器行動裝置版面
- **v0.5.0** _(01-04)_: 貼圖模式（含裁切與進階選項）

### v0.4.x - OPFS 圖片儲存

_2026-01-04_

- **v0.4.2**: 忽略 .gemini-clipboard 目錄
- **v0.4.1**: 生成歷史對齊與捲軸間距調整
- **v0.4.0**: OPFS 圖片儲存、WebP 壓縮

### v0.3.x - 觸控手勢

_2026-01-03_

- **v0.3.0**: 燈箱觸控手勢支援

### v0.2.x - Hero 區段

_2026-01-03_

- **v0.2.0**: Hero 區段動畫與滾動效果

### v0.1.x - 初始版本

_2026-01-03_

- **v0.1.0**: 初始版本
  - AI 圖片生成（Gemini API）
  - 多圖上傳、燈箱縮放/平移
  - 思考過程顯示、Toast 通知
  - 歷史紀錄儲存
